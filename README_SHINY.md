# Shiny App: Hospital Readmission Prediction

Interactive web application for predicting 30-day hospital readmissions using Logistic Regression, CART, and Random Forest models.

## Prerequisites

### Required R Packages

Install the following packages if not already installed:

```r
install.packages(c("shiny", "ggplot2", "dplyr", "pROC", "caret", 
                   "rpart", "rpart.plot", "randomForest", "DT"))
```

### Required Files

Before running the app, ensure you have:

1. **Data files** (from data cleaning phase):
   - `data_logistic.RData`
   - `data_cart.RData`
   - `data_clean.RData`

2. **Model files** (generated by `save_models.R`):
   - `model_logistic.RData`
   - `model_cart_final.RData`
   - `model_rf.RData`

3. **Performance metrics** (from analysis phases):
   - `plots/04_performance_metrics.csv`
   - `plots/05_performance_metrics.csv`
   - `plots/05b_performance_metrics.csv`
   - `plots/04_auc.csv`
   - `plots/05_auc.csv`
   - `plots/05b_auc.csv`
   - `plots/04_regression_output.csv`
   - `plots/05_variable_importance.csv`
   - `plots/05b_variable_importance.csv`

4. **Helper functions**:
   - `app_helpers.R`

## Setup Instructions

### Step 1: Train and Save Models

First, run the model training script to generate the model files:

```r
source("save_models.R")
```

This will:
- Train all three models (Logistic Regression, CART, Random Forest)
- Save them to RData files
- Take approximately 5-10 minutes (mostly for Random Forest)

### Step 2: Verify Files

Ensure all required files are in the project directory:

```r
# Check for model files
file.exists("model_logistic.RData")
file.exists("model_cart_final.RData")
file.exists("model_rf.RData")

# Check for data files
file.exists("data_logistic.RData")
file.exists("data_cart.RData")

# Check for helper functions
file.exists("app_helpers.R")
```

### Step 3: Run the App Locally

**Option A: Using RStudio**
1. Open `app.R` in RStudio
2. Click the "Run App" button (top right of the editor)
3. Or use: `shiny::runApp("app.R")`

**Option B: Using R Console**
```r
library(shiny)
runApp("app.R")
```

**Option C: Using Command Line**
```bash
Rscript -e "shiny::runApp('app.R', port=3838, host='0.0.0.0')"
```

The app will open in your default web browser, typically at `http://127.0.0.1:XXXX` (port number shown in console).

## Using the App

### Input Patient Information

1. **Hospital Stay Information**:
   - Time in Hospital (days): 1-14
   - Number of Lab Procedures: 0-132
   - Number of Procedures: 0-6
   - Number of Medications: 1-81

2. **Previous Visits**:
   - Previous Outpatient Visits: 0-42
   - Previous Inpatient Visits: 0-21
   - Previous Emergency Visits: 0-76

3. **Diagnoses**:
   - Number of Diagnoses: 1-16

4. **Demographics & Medical Info**:
   - Age Group: Select from dropdown
   - Medical Specialty: Select from dropdown
   - Primary Diagnosis: Select from dropdown

5. **Medications & Tests**:
   - Change in Medication: Yes/No
   - Diabetes Medication: Yes/No
   - Glucose Test: Yes/No
   - A1C Test: Yes/No

### View Predictions

1. Enter patient information in the sidebar
2. Click "Predict Readmission Risk" button
3. View results in the **Prediction** tab:
   - Average readmission probability across all models
   - Individual model predictions
   - Risk level (Low/Moderate/High)
   - Visual probability bars

### Explore Visualizations

Navigate to the **Visualizations** tab to see:
- ROC curves for all models
- Feature importance plots
- Model performance metrics

### Compare Models

The **Model Comparison** tab shows:
- Side-by-side performance metrics
- AUC comparison chart
- Key differences between models
- Recommended model for clinical use

## Deployment

### Deploy to shinyapps.io (Recommended for Beginners)

1. **Create Account**:
   - Go to https://www.shinyapps.io/
   - Sign up for a free account

2. **Install rsconnect**:
```r
install.packages("rsconnect")
```

3. **Authorize Your Account**:
```r
library(rsconnect)
rsconnect::setAccountInfo(
  name = "your-account-name",
  token = "your-token",
  secret = "your-secret"
)
```
(Get token and secret from your shinyapps.io account dashboard)

4. **Deploy the App**:
```r
rsconnect::deployApp(
  appDir = getwd(),
  appFiles = c("app.R", "app_helpers.R", 
               "model_logistic.RData", "model_cart_final.RData", "model_rf.RData",
               "data_cart.RData", "plots"),
  appName = "hospital-readmission-prediction"
)
```

**Note**: The free tier has limitations on app size and usage. You may need to:
- Compress model files
- Remove unnecessary files from deployment
- Use `appFiles` parameter to specify only required files

### Deploy to Shiny Server (Self-Hosted)

1. **Install Shiny Server**:
   - Follow instructions at https://rstudio.com/products/shiny/shiny-server/

2. **Place App Files**:
   - Copy app files to `/srv/shiny-server/hospital-readmission/`

3. **Set Permissions**:
```bash
sudo chown -R shiny:shiny /srv/shiny-server/hospital-readmission
```

4. **Access App**:
   - Navigate to `http://your-server-ip:3838/hospital-readmission`

### Deploy to RStudio Connect

1. **Publish from RStudio**:
   - Open `app.R` in RStudio
   - Click "Publish" button
   - Select "RStudio Connect"
   - Follow the publishing wizard

## Troubleshooting

### Common Issues

1. **"Models not found" error**:
   - Ensure you've run `save_models.R` first
   - Check that model files are in the same directory as `app.R`

2. **"Factor levels don't match" error**:
   - This happens if input values don't match training data levels
   - Ensure dropdown options match the factor levels in `data_cart.RData`

3. **"CSV files not found" error**:
   - Ensure all analysis phases have been run
   - Check that `plots/` directory contains all required CSV files

4. **App runs slowly**:
   - Models are loaded at startup (this is normal)
   - First prediction may take a few seconds
   - Subsequent predictions should be fast

5. **Encoding errors**:
   - Check that `app_helpers.R` is in the same directory
   - Verify helper functions are working correctly

### Performance Optimization

For faster startup:
- Pre-load models in a separate R session
- Use `saveRDS()` instead of `save()` for faster loading
- Consider using `future` package for parallel predictions

For smaller deployment size:
- Compress model files using `compress = TRUE` in `save()`
- Remove unnecessary data from model objects
- Use `appFiles` parameter to deploy only required files

## File Structure

```
projects/
├── app.R                    # Main Shiny application
├── app_helpers.R            # Encoding helper functions
├── save_models.R            # Script to train and save models
├── model_logistic.RData     # Trained Logistic Regression model
├── model_cart_final.RData   # Trained CART model
├── model_rf.RData           # Trained Random Forest model
├── data_logistic.RData      # Data for Logistic Regression
├── data_cart.RData          # Data for CART/Random Forest
├── plots/                   # Performance metrics and visualizations
│   ├── 04_*.csv             # Logistic Regression outputs
│   ├── 05_*.csv             # CART outputs
│   └── 05b_*.csv            # Random Forest outputs
└── README_SHINY.md          # This file
```

## Features

- **Real-time Predictions**: Change inputs and see predictions update
- **Three Model Comparison**: View predictions from all three models simultaneously
- **Interactive Visualizations**: Explore ROC curves, feature importance, and performance metrics
- **User-Friendly Interface**: Clean, professional design with clear input controls
- **Error Handling**: Graceful error messages for invalid inputs
- **Responsive Design**: Works on desktop and tablet devices

## Limitations

- Models are trained on data from 1999-2008 and may not reflect current healthcare practices
- Predictions are for demonstration purposes and should not be used for actual clinical decision-making
- The app requires all model and data files to be present
- Some visualizations require pre-generated CSV files from the analysis phases

## Support

For issues or questions:
1. Check that all prerequisites are met
2. Verify all required files are present
3. Review error messages in the R console
4. Check the main project README.md for additional information

## License

This project is for educational purposes as part of a Computational Math course.

---

**Last Updated**: December 2025

